<script type="text/javascript" language="javascript">

function send()
{
    ///alert("calling url v9");
    var corsProxy = 'https://cors-anywhere.herokuapp.com/'
    var url = 'https://buenos-aires.restorando.com.ar/restaurantes-en-martinez,palermo,san-isidro,vicente-lopez,zona-norte/con-precio-4,5';
    var request = new Request(corsProxy + url, {
      method: 'GET', 
      headers: { }
    });
    fetch(request)
    .then(res => res.text())  
    .then(function(data) {
        var myRegexp = new RegExp('window\.__INITIAL_STATE__ = (.*?);($|\n)');
        var matcher = myRegexp.exec(data);
        var restaurantsJSON = JSON.parse(matcher[1]).search.restaurants;
                
        var randomIndex = Math.floor(Math.random() * restaurantsJSON.length);
        var selectedRestaurantJSON = restaurantsJSON[randomIndex];
        createTable(selectedRestaurantJSON);
      ///  document.getElementById("div").innerHTML = selectedRestaurantJSON.name;
    })
    .catch(function(err) {
    alert(err);
    });
 }
    
function createTable(restaurantData) {
  var table = document.createElement('table');
  table.setAttribute('border','1');
  table.setAttribute('width','100%')
  addTableHeaders(table, ['Nombre','URL']);
  var tableBody = document.createElement('tbody');

  var row = document.createElement('tr');
  ///x2
  var cell = document.createElement('td');
  cell.appendChild(document.createTextNode(restaurantData.name));
  row.appendChild(cell);
    
  var link = document.createElement("a");
  link.setAttribute("href", restaurantData.url);
  var linkText = document.createTextNode(restaurantData.url);
  link.appendChild(linkText);
  var cell = document.createElement('td');
  cell.appendChild(link);
  row.appendChild(cell);

  tableBody.appendChild(row);
  table.appendChild(tableBody);
  document.getElementById("div").appendChild(table);
}
    
function addTableHeaders(table, headerNames){
    var header = table.createTHead();
    var row = header.insertRow(0);  
    var y = 0;
    headerNames.forEach(function(headerName) {
        var cell = row.insertCell(y);
        cell.innerHTML = '<b>' + headerName + '</b>';   
        y++;
    });
}
    
</script>


<html>
<body id='bod'><button type="submit" onclick="javascript:send()">Buscar</button>
    <br />
    <div id='div'>
    </div>
</body>
</html>
